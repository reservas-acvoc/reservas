{% extends "base.html" %}

{% block title %}Reservas Futuras de Todos{% endblock %}

{% block content %}
    <h2 class="mb-4">Reservas de Todos</h2>

    {% if reservas_futuras %}
        <div class="table-responsive">
            <table id="reservasFuturasTable" class="table table-striped table-hover align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>Nome</th>
                        <th>Data</th>
                        <th>Horário</th>
                        <th>Tipo de Reserva</th>
                        <th>Ações</th>
                    </tr>
                    <!-- Filtros no cabeçalho -->
                    <tr>
                        <th><input type="text" id="filtroNome" class="form-control" placeholder="Filtrar Nome"></th>
                        <th><input type="text" id="filtroData" class="form-control" placeholder="Filtrar Data"></th>
                        <th><input type="text" id="filtroHorario" class="form-control" placeholder="Filtrar Horário"></th>
                        <th><input type="text" id="filtroTipo" class="form-control" placeholder="Filtrar Tipo"></th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for key, reserva in reservas_futuras.items() %}
                        <tr>
                            <td>{{ reserva.nome }}</td>
                            <td>{{ reserva.data }}</td>
                            <td>{{ reserva.hora_inicio }} - {{ reserva.hora_fim }}</td>
                            <td>{{ reserva.tipo_reserva | capitalize }}</td>
                            <td>
                                <!-- Botão para excluir a reserva -->
                                <form action="{{ url_for('remover_reserva', id=key) }}" method="POST" style="display:inline;">
                                    <button type="submit" class="btn btn-danger btn-sm">Excluir</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p>Nenhuma reserva futura encontrada.</p>
    {% endif %}

    <!-- Script para aplicar o filtro na tabela -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Filtro por Nome
            document.getElementById('filtroNome').addEventListener('keyup', function () {
                filtrarTabela(0, this.value);
            });

            // Filtro por Data
            document.getElementById('filtroData').addEventListener('keyup', function () {
                filtrarTabela(1, this.value);
            });

            // Filtro por Horário
            document.getElementById('filtroHorario').addEventListener('keyup', function () {
                filtrarTabela(2, this.value);
            });

            // Filtro por Tipo de Reserva
            document.getElementById('filtroTipo').addEventListener('keyup', function () {
                filtrarTabela(3, this.value);
            });

            // Função para filtrar a tabela
            function filtrarTabela(coluna, valorFiltro) {
                var tabela = document.getElementById("reservasFuturasTable");
                var linhas = tabela.getElementsByTagName("tr");

                for (var i = 2; i < linhas.length; i++) {  // Começa a partir da 3ª linha (pulando o cabeçalho)
                    var celulas = linhas[i].getElementsByTagName("td");
                    if (celulas) {
                        var valorCelula = celulas[coluna].textContent || celulas[coluna].innerText;
                        if (valorCelula.toUpperCase().indexOf(valorFiltro.toUpperCase()) > -1) {
                            linhas[i].style.display = "";
                        } else {
                            linhas[i].style.display = "none";
                        }
                    }
                }
            }
        });
    </script>
{% endblock %}
